# Runner Guide

How to start, stop, and manage all three applications for local development.

---

## Service Map

| App              | Port  | Tech                   |
|------------------|-------|------------------------|
| Go backend       | 8080  | Go / net/http          |
| Python backend   | 8000  | FastAPI / uvicorn      |
| Expo client      | 8081  | Expo / React Native    |
| PostgreSQL       | 5432  | Docker                 |
| Qdrant REST      | 6333  | Docker                 |
| Qdrant gRPC      | 6334  | Docker                 |
| Ollama           | 11434 | Native macOS           |

---

## Step 1 — Start Infrastructure (required before any backend)

```bash
# From the project root
docker-compose up -d

# Pull and start Ollama models (first time only)
ollama pull nomic-embed-text
ollama run llama3.1:8b
```

> `ollama run` keeps the model loaded. Run it in its own terminal or use `ollama serve` to run the daemon in the background.

**Stop infrastructure:**
```bash
docker-compose down

# Wipe all data volumes (destructive)
docker-compose down -v
```

---

## Step 2A — Backend: Go (`services/core-go`, Port 8080)

Open a new terminal:

```bash
cd services/core-go
go run cmd/api/main.go
```

**Stop:** `Ctrl+C`

**Notes:**
- No virtual environment needed — Go fetches dependencies from `go.mod` automatically
- To pre-download deps without running: `go mod download`

**Health check:**
```bash
curl http://localhost:8080/health
```

---

## Step 2B — Backend: Python (`services/core-python`, Port 8000)

Open a new terminal:

```bash
cd services/core-python

# Activate venv (prompt changes to show "(venv)")
source venv/bin/activate

# Install deps — only needed once or after requirements.txt changes
pip install -r requirements.txt

# Start server
uvicorn app.main:app --reload --port 8000
```

**Stop:**
```bash
Ctrl+C        # stops uvicorn
deactivate    # exits the venv
```

> `--reload` enables hot-reload on file changes. Remove it for a stable run.

**Health check:**
```bash
curl http://localhost:8000/health
```

**Interactive API docs (auto-generated by FastAPI):**
- Swagger UI: `http://localhost:8000/docs`
- ReDoc: `http://localhost:8000/redoc`

---

## Step 3 — Client: Expo App (`client/personal-agentic-assistant`)

Open a new terminal:

```bash
cd client/personal-agentic-assistant
npx expo start
```

The Expo dev server starts and shows a **QR code** in the terminal.

**Open the app — pick one:**

| Key | Action                                              |
|-----|-----------------------------------------------------|
| `i` | Open in iOS Simulator (requires Xcode)              |
| `a` | Open in Android Emulator (requires Android Studio)  |
| `w` | Open in web browser                                 |
| QR  | Scan with **Expo Go** app on a physical device      |

**Stop:** `Ctrl+C` in the Expo terminal.

**If node_modules is missing:**
```bash
npm install
```
> `node_modules` is already present — `npm install` is only needed after pulling fresh changes.

---

## Quick Reference

| Action                       | Command                                                  |
|------------------------------|----------------------------------------------------------|
| Start infrastructure         | `docker-compose up -d`                                   |
| Stop infrastructure          | `docker-compose down`                                    |
| Run Go backend               | `cd services/core-go && go run cmd/api/main.go`          |
| Activate Python venv         | `cd services/core-python && source venv/bin/activate`    |
| Run Python backend           | `uvicorn app.main:app --reload --port 8000`              |
| Deactivate Python venv       | `deactivate`                                             |
| Run Expo client              | `cd client/personal-agentic-assistant && npx expo start` |
| Stop any running server      | `Ctrl+C`                                                 |
| Go health check              | `curl http://localhost:8080/health`                      |
| Python health check          | `curl http://localhost:8000/health`                      |
